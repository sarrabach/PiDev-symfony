{% extends 'base.html.twig' %}

{% block title %}User index
{% endblock %}

{% block body %}

	{% if userconnected.role=="Admin" %}
	<div class="content-wrapper">
		<!-- Content Header (Page header) -->
		<section class="content-header">
			<div class="container-fluid">
				<div class="row mb-2">
					<div class="col-sm-6">
						<h1>DataTables</h1>
					</div>
					<div class="col-sm-6">
						<ol class="breadcrumb float-sm-right">
							<li class="breadcrumb-item">
								<a href="#">Home</a>
							</li>
							<li class="breadcrumb-item active">DataTables</li>
						</ol>
					</div>
				</div>
			</div>
			<!-- /.container-fluid -->
		</section>
		<!-- Main content -->
		<section class="content">

			<div class="container-fluid">
				<div class="row">
					<div class="col-14">
					<div class="card">
						<div class="card-header">
							<h3 class="card-title">DataTable with default features</h3>
						</div>
						<!-- /.card-header -->
						<div class="card-body">
							<table id="userTable" class="table table-bordered table-striped">
							<thead>
							<tr>
							<th>User Firstname</th>
							<th>User Lastname</th>
							<th>Mail</th>
							<th>Phone</th>
							<th>Username</th>
							<th>Password</th>
							<th>Role</th>
							<th>Lang1</th>
							<th>Lang2</th>
							<th>Lang3</th>
							<th>Cityname</th>
							<th>Nationality</th>
			     			<th>Langue</th>
							<th>actions</th>
							</tr>
							</thead>
							<tbody>
                            {% if users %}
							{% for user in users %}
							<tr>
							<td>{{ user.userFirstname }}</td>
							<td>{{ user.userLastname }}</td>
							<td>{{ user.userMail }}</td>
							<td>{{ user.userPhone }}</td>
					    	<td>{{ user.username }}</td>
							<td>{{ user.password }}</td>
							<td>{{ user.role }}</td>
							<td>{{ user.lang1 }}</td>
							<td>{{ user.lang2 }}</td>
							<td>{{ user.lang3 }}</td>
							<td>{{ user.cityname }}</td>
							<td>{{ user.nationality }}</td>
							<td>{{ user.langue }}</td>
							<td class="project-actions text-right">
							<a class="btn btn-primary btn-sm" href="{{ path('app_user_show', {'idUser': user.idUser}) }}">
							<i class="fas fa-folder"></i>View</a>
							<a class="btn btn-info btn-sm" href="{{ path('app_user_edit', {'idUser': user.idUser}) }}">
							<i class="fas fa-pencil-alt"></i>Edit</a>
						<form method="post" action="{{ path('app_user_delete', {'idUser': user.idUser}) }}" onsubmit="return confirm('Are you sure you want to delete this item?');">
														<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.idUser) }}">
														<button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i>Delete</button>
													</form>
							</td>
							</tr>

                           
							{% endfor %}
                             {% endif %}
								</tbody>
							
							</table>
						</div>
						<!-- /.card-body -->
					</div>
					<!-- /.card -->
				</div>
				<!-- /.col -->
			</div>
			<!-- /.row -->
		</div >
		<!-- /.container-fluid -->
	</section>
		{% endif %}
	<!-- /.content -->
</div>
<script>
	/*function searchTable() {
		// Declare variables
		var input, filter, table, tr, td, i, txtValue;
		input = document.getElementById("searchInput");
		filter = input.value.toUpperCase();
		table = document.getElementById("userTable");
		tr = table.getElementsByTagName("tr");

		// Loop through all table rows, and hide those that don't match the search query
		for (i = 0; i < tr.length; i++) {
			td = tr[i].getElementsByTagName("td");
			for (j = 0; j < td.length; j++) {
				txtValue = td[j].textContent || td[j].innerText;
				if (txtValue.toUpperCase().indexOf(filter) > -1) {
					tr[i].style.display = "";
					break;
				} else {
					tr[i].style.display = "none";
				}
			}
		}
	}*/
	function searchTable() {

		// Get the search query from the input field
		var query = document.getElementById("searchInput").value;

		// Send an AJAX request to the server
		$.ajax({
			url: "/user/search", // The URL of the search endpoint
			type: "GET",
			data: {query: query}, // The search query
			success: function(data) {
				// Parse the JSON data
				var users = JSON.parse(data);

				// Clear the existing table rows
				$("#userTable tbody").empty();

				// Loop through the search results and add new rows to the table
				for (var i = 0; i < users.length; i++) {
					var user = users[i];
					var row = "<tr>" +
							"<td>" + user.userFirstname + "</td>" +
							"<td>" + user.userLastname + "</td>" +
							"<td>" + user.userMail + "</td>" +
							"<td>" + user.userPhone + "</td>" +
							"<td>" + user.username + "</td>" +
							"<td>" + user.password + "</td>" +
							"<td>" + user.role + "</td>" +
							"<td>" + user.lang1 + "</td>" +
							"<td>" + user.lang2 + "</td>" +
							"<td>" + user.lang3 + "</td>" +
							"<td>" + user.cityname + "</td>" +
							"<td>" + user.nationality + "</td>" +
							"<td>" + user.langue + "</td>" +
							"<td class='project-actions text-right'>" +
							"<a class='btn btn-primary btn-sm' href='/user/show/" + user.idUser + "'>" +
							"<i class='fas fa-folder'></i>View</a>" +
							"<a class='btn btn-info btn-sm' href='/user/edit/" + user.idUser + "'>" +
							"<i class='fas fa-pencil-alt'></i>Edit</a>" +
							"<a class='btn btn-danger btn-sm' href='/user/delete/" + user.idUser + "'>" +
							"<i class='fas fa-trash'></i>Delete</a>" +
							"</td>" +
							"</tr>";
					$("#userTable tbody").append(row);
				}
			}
		});
	}

	$(document).ready(function() {
		// Update the search results whenever the search query changes
		$("#searchInput").on("input", searchTable);
	});
</script>
<!-- jQuery -->
<script src="{{ asset('../../plugins/jquery/jquery.min.js')}}"></script>
<!-- Bootstrap 4 -->
<script src="{{ asset('../../plugins/bootstrap/js/bootstrap.bundle.min.js')}}"></script>
<!-- DataTables  & Plugins -->
<script src="{{ asset('../../plugins/datatables/jquery.dataTables.min.js')}}"></script>
<script src="{{ asset('../../plugins/datatables-bs4/js/dataTables.bootstrap4.min.js')}}"></script>
<script src="{{ asset('../../plugins/datatables-responsive/js/dataTables.responsive.min.js')}}"></script>
<script src="{{ asset('../../plugins/datatables-responsive/js/responsive.bootstrap4.min.js')}}"></script>
<script src="{{ asset('../../plugins/datatables-buttons/js/dataTables.buttons.min.js')}}"></script>
<script src="{{ asset('../../plugins/datatables-buttons/js/buttons.bootstrap4.min.js')}}"></script>
<script src="{{ asset('../../plugins/jszip/jszip.min.js')}}"></script>
<script src="{{ asset('../../plugins/pdfmake/pdfmake.min.js')}}"></script>
<script src="{{ asset('../../plugins/pdfmake/vfs_fonts.js')}}"></script>
<script src="{{ asset('../../plugins/datatables-buttons/js/buttons.html5.min.js')}}"></script>
<script src="{{ asset('../../plugins/datatables-buttons/js/buttons.print.min.js')}}"></script>
<script src="{{ asset('../../plugins/datatables-buttons/js/buttons.colVis.min.js')}}"></script>
<!-- AdminLTE App -->
<script src="{{ asset('../../dist/js/adminlte.min.js')}}"></script>
<!-- AdminLTE for demo purposes -->
<script src="{{ asset('../../dist/js/demo.js')}}"></script>
<!-- Page specific script -->
<script>
	$(function () {
$("#example1").DataTable({
"responsive": true,
"lengthChange": true,
"autoWidth": true,
"buttons": [
"copy",
"csv",
"excel",
"pdf",
"print",
"colvis"
]
}).buttons().container().appendTo('#example1_wrapper .col-md-6:eq(0)');
$('#example2').DataTable({
"paging": false,
"lengthChange": false,
"searching": false,
"ordering": true,
"info": false,
"autoWidth": false,
"responsive": true
}).buttons().container().appendTo('#example2_wrapper .col-md-6:eq(0)');
});
</script>
{% endblock %}